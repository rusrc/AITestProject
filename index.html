<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ –î–æ—Å–∫–∞ –ø–æ—á—ë—Ç–∞ –∫–æ–º–∞–Ω–¥—ã</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .achievement-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid;
            transition: transform 0.2s ease;
        }
        .achievement-icon:hover {
            transform: scale(1.1);
        }
        .achievement-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            max-width: 100%;
            justify-content: center;
            align-items: center;
        }
        .member-card {
            max-width: 50%;
            margin: 0 auto 2rem auto;
        }
        @media (max-width: 768px) {
            .member-card {
                max-width: 90%;
            }
        }
    </style>
</head>
<body class="bg-base-100 min-h-screen">
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="navbar bg-base-200 shadow-lg">
        <div class="flex-1">
            <h1 class="text-2xl font-bold">üèÜ –ö–æ–º–∞–Ω–¥–∞</h1>
        </div>
        <div class="flex-none gap-2">
            <!-- –°–µ–ª–µ–∫—Ç–æ—Ä —Ç–µ–º -->
            <div class="dropdown dropdown-end">
                <div tabindex="0" role="button" class="btn btn-ghost">
                    <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z" />
                    </svg>
                    –¢–µ–º–∞
                </div>
                <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a onclick="setTheme('light')">‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è</a></li>
                    <li><a onclick="setTheme('dark')">üåô –¢—ë–º–Ω–∞—è</a></li>
                    <li><a onclick="setTheme('cupcake')">üßÅ Cupcake</a></li>
                    <li><a onclick="setTheme('bumblebee')">üêù Bumblebee</a></li>
                    <li><a onclick="setTheme('emerald')">üíé Emerald</a></li>
                    <li><a onclick="setTheme('corporate')">üè¢ Corporate</a></li>
                    <li><a onclick="setTheme('synthwave')">üåÜ Synthwave</a></li>
                    <li><a onclick="setTheme('retro')">üì∫ Retro</a></li>
                    <li><a onclick="setTheme('cyberpunk')">ü§ñ Cyberpunk</a></li>
                    <li><a onclick="setTheme('valentine')">üíù Valentine</a></li>
                    <li><a onclick="setTheme('halloween')">üéÉ Halloween</a></li>
                    <li><a onclick="setTheme('garden')">üåª Garden</a></li>
                    <li><a onclick="setTheme('forest')">üå≤ Forest</a></li>
                    <li><a onclick="setTheme('aqua')">üêü Aqua</a></li>
                    <li><a onclick="setTheme('lofi')">üéµ Lofi</a></li>
                    <li><a onclick="setTheme('pastel')">üå∏ Pastel</a></li>
                    <li><a onclick="setTheme('fantasy')">üßö Fantasy</a></li>
                    <li><a onclick="setTheme('wireframe')">üìê Wireframe</a></li>
                    <li><a onclick="setTheme('black')">‚ö´ Black</a></li>
                    <li><a onclick="setTheme('luxury')">üíé Luxury</a></li>
                    <li><a onclick="setTheme('dracula')">üßõ Dracula</a></li>
                    <li><a onclick="setTheme('cmyk')">üé® CMYK</a></li>
                    <li><a onclick="setTheme('autumn')">üçÇ Autumn</a></li>
                    <li><a onclick="setTheme('business')">üíº Business</a></li>
                    <li><a onclick="setTheme('acid')">üß™ Acid</a></li>
                    <li><a onclick="setTheme('lemonade')">üçã Lemonade</a></li>
                    <li><a onclick="setTheme('night')">üåô Night</a></li>
                    <li><a onclick="setTheme('coffee')">‚òï Coffee</a></li>
                    <li><a onclick="setTheme('winter')">‚ùÑÔ∏è Winter</a></li>
                </ul>
            </div>
            <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ -->
            <button class="btn btn-primary" onclick="addMemberModal.showModal()">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
            </button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="container mx-auto px-4 py-8">
        <div id="members-container">
            <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ API -->
        </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞—á–∏–≤–∫–∏ -->
    <dialog id="addAchievementModal" class="modal">
        <div class="modal-box">
            <h3 class="font-bold text-lg mb-4">–î–æ–±–∞–≤–∏—Ç—å –∞—á–∏–≤–∫—É</h3>
            <form id="addAchievementForm">
                <input type="hidden" id="memberIdForAchievement" value="1" />
                
                <div class="form-control w-full mb-4">
                    <label class="label">
                        <span class="label-text">–ò–∫–æ–Ω–∫–∞ –∞—á–∏–≤–∫–∏</span>
                    </label>
                    <input type="file" name="image" class="file-input file-input-bordered w-full" accept="image/*" required />
                </div>
                
                <div class="form-control w-full mb-4">
                    <label class="label">
                        <span class="label-text">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</span>
                    </label>
                    <select name="category" class="select select-bordered w-full" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        <option value="positive">üü¢ Positive</option>
                        <option value="negative">üî¥ Negative</option>
                    </select>
                </div>
                
                <div class="modal-action">
                    <button type="button" class="btn btn-ghost" onclick="addAchievementModal.close()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </dialog>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ -->
    <dialog id="addMemberModal" class="modal">
        <div class="modal-box">
            <h3 class="font-bold text-lg mb-4">–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</h3>
            <form id="addMemberForm">
                <div class="form-control w-full mb-4">
                    <label class="label">
                        <span class="label-text">–§–æ—Ç–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞</span>
                    </label>
                    <input type="file" class="file-input file-input-bordered w-full" accept="image/*" required />
                </div>
                
                <div class="form-control w-full mb-4">
                    <label class="label">
                        <span class="label-text">–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞</span>
                    </label>
                    <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" class="input input-bordered w-full" required />
                </div>
                
                <div class="form-control w-full mb-4">
                    <label class="label">
                        <span class="label-text">–†–æ–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</span>
                    </label>
                    <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–æ–ª—å" class="input input-bordered w-full" required />
                </div>
                
                <div class="modal-action">
                    <button type="button" class="btn btn-ghost" onclick="addMemberModal.close()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </dialog>

    <script>
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–∞–º–∏
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π —Ç–µ–º—ã
        const savedTheme = localStorage.getItem('theme') || 'dark';
        setTheme(savedTheme);

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        const addAchievementModal = document.getElementById('addAchievementModal');
        const addMemberModal = document.getElementById('addMemberModal');

        // –ó–∞–≥—Ä—É–∑–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadMembers() {
            try {
                const response = await fetch('http://localhost:5000/api/members');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        renderMembers(data.data);
                    }
                } else {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:', error);
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function renderMembers(members) {
            const container = document.getElementById('members-container');
            container.innerHTML = '';

            if (members.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <p class="text-lg opacity-70">–ü–æ–∫–∞ –Ω–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥—ã</p>
                        <p class="text-sm opacity-50">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ</p>
                    </div>
                `;
                return;
            }

            members.forEach(member => {
                const memberCard = createMemberCard(member);
                container.appendChild(memberCard);
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞
        function createMemberCard(member) {
            const card = document.createElement('div');
            card.className = 'card member-card bg-base-200 shadow-xl';
            
            // –†–∞–∑–¥–µ–ª—è–µ–º –∞—á–∏–≤–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            const positiveAchievements = member.achievements.filter(a => a.category === 'positive');
            const negativeAchievements = member.achievements.filter(a => a.category === 'negative');

            card.innerHTML = `
                <div class="card-body items-center text-center">
                    <!-- –ê–≤–∞—Ç–∞—Ä -->
                    <div class="avatar mb-4">
                        <div class="w-24 rounded-full">
                            <img src="${member.avatar}" alt="–ê–≤–∞—Ç–∞—Ä ${member.name}" />
                        </div>
                    </div>
                    
                    <!-- –ù–æ–º–µ—Ä, –∏–º—è –∏ —Ä–æ–ª—å -->
                    <div class="badge badge-primary badge-lg mb-2">#${member.sort_order}</div>
                    <h2 class="card-title text-2xl">${member.name}</h2>
                    <p class="text-lg opacity-70">${member.role}</p>
                    
                    <!-- –ë–ª–æ–∫–∏ –∞—á–∏–≤–æ–∫ -->
                    <div class="w-full mt-6">
                        <!-- Positive –∞—á–∏–≤–∫–∏ -->
                        <div class="mb-6">
                            <h3 class="text-lg font-bold text-center mb-3 text-green-600">üèÖ Positive</h3>
                            <div class="achievement-grid">
                                ${positiveAchievements.map(achievement => 
                                    `<img src="${achievement.image}" alt="–ê—á–∏–≤–∫–∞" class="achievement-icon border-green-500" />`
                                ).join('')}
                            </div>
                        </div>
                        
                        <!-- Negative –∞—á–∏–≤–∫–∏ -->
                        <div class="mb-4">
                            <h3 class="text-lg font-bold text-center mb-3 text-red-600">‚ö†Ô∏è Negative</h3>
                            <div class="achievement-grid">
                                ${negativeAchievements.map(achievement => 
                                    `<img src="${achievement.image}" alt="–ê—á–∏–≤–∫–∞" class="achievement-icon border-red-500" />`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞—á–∏–≤–∫–∏ -->
                    <div class="card-actions justify-end">
                        <button class="btn btn-outline btn-sm" onclick="openAddAchievementModal(${member.id})">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞—á–∏–≤–∫—É
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞—á–∏–≤–∫–∏ —Å ID —É—á–∞—Å—Ç–Ω–∏–∫–∞
        function openAddAchievementModal(memberId) {
            document.getElementById('memberIdForAchievement').value = memberId;
            addAchievementModal.showModal();
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadMembers();

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞—á–∏–≤–∫–∏
        document.getElementById('addAchievementForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            const fileInput = this.querySelector('input[type="file"]');
            const categorySelect = this.querySelector('select[name="category"]');
            const memberIdInput = this.querySelector('input[type="hidden"]');
            
            if (fileInput.files[0]) {
                formData.append('image', fileInput.files[0]);
            }
            formData.append('category', categorySelect.value);
            formData.append('member_id', memberIdInput.value);
            
            try {
                const response = await fetch('http://localhost:5000/api/achievements', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    addAchievementModal.close();
                    this.reset();
                    console.log('–ê—á–∏–≤–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                    loadMembers();
                } else {
                    const errorData = await response.json();
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∞—á–∏–≤–∫–∏:', errorData);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∞—á–∏–≤–∫–∏: ' + (errorData.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞
        document.getElementById('addMemberForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            const fileInput = this.querySelector('input[type="file"]');
            const nameInput = this.querySelector('input[placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è"]');
            const roleInput = this.querySelector('input[placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–æ–ª—å"]');
            
            if (fileInput.files[0]) {
                formData.append('image', fileInput.files[0]);
            }
            formData.append('name', nameInput.value);
            formData.append('role', roleInput.value);
            
            try {
                const response = await fetch('http://localhost:5000/api/members', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    addMemberModal.close();
                    this.reset();
                    console.log('–£—á–∞—Å—Ç–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                    loadMembers();
                } else {
                    const errorData = await response.json();
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞:', errorData);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞: ' + (errorData.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
            }
        });
    </script>
</body>
</html>
